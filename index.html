<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TXTä¹¦ç­¾ç®¡ç†å™¨</title>
    <!-- å¹¿å‘Šä»£ç  -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2576884527497195"
     crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #f0f8ff;
            color: #333;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }
        
        .ad-container {
            margin: 20px auto;
            text-align: center;
            max-width: 1200px;
        }
        
        .upload-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px dashed #3498db;
        }
        
        .upload-label {
            display: block;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .upload-input {
            display: none;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            margin: 10px;
        }
        
        .upload-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f6395);
            transform: translateY(-2px);
        }
        
        .file-info {
            margin-top: 15px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f6395);
            transform: translateY(-2px);
        }
        
        .btn-download {
            background: linear-gradient(135deg, #27ae60, #219653);
        }
        
        .btn-download:hover {
            background: linear-gradient(135deg, #219653, #1e8449);
        }
        
        .btn-export-txt {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }
        
        .btn-export-txt:hover {
            background: linear-gradient(135deg, #732d91, #5b2c6f);
        }
        
        .btn-auto-download {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-auto-download:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .auto-download-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #219653;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        #bookmarkList {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .bookmark-item {
            padding: 12px 0;
            border-bottom: 1px dashed #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bookmark-link {
            color: #2980b9;
            text-decoration: none;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            flex-grow: 1;
        }
        
        .bookmark-link:hover {
            background-color: #e8f4fc;
            text-decoration: underline;
        }
        
        .bookmark-actions {
            display: flex;
            gap: 5px;
        }
        
        .bookmark-btn {
            background-color: #ecf0f1;
            color: #7f8c8d;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bookmark-btn:hover {
            background-color: #d5dbdb;
        }
        
        .empty-state {
            text-align: center;
            color: #95a5a6;
            padding: 40px 20px;
            font-style: italic;
        }
        
        /* æ·»åŠ ä¹¦ç­¾æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .modal {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 400px;
            max-width: 90%;
        }
        
        .modal h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-cancel {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .btn-cancel:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
        }
        
        .instructions {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .instructions h3 {
            margin-top: 0;
        }
        
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .txt-format {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š TXTä¹¦ç­¾ç®¡ç†å™¨</h1>
        
        <!-- å¹¿å‘Š -->
        <div class="ad-container">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2576884527497195"
                crossorigin="anonymous"></script>
            <!-- å¹¿å‘Š -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2576884527497195"
                 data-ad-slot="7670752513"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <p>ä¸Šä¼ TXTæ–‡ä»¶æ¥å¯¼å…¥ä¹¦ç­¾ã€‚TXTæ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š</p>
            <ul>
                <li>æ¯è¡Œä¸€ä¸ªä¹¦ç­¾</li>
                <li>æ ¼å¼ï¼š<span class="txt-format">ä¹¦ç­¾æ ‡é¢˜,URLåœ°å€</span></li>
                <li>ç¤ºä¾‹ï¼š<span class="txt-format">äº¬ä¸œé¦–é¡µ,https://www.jd.com</span></li>
                <li>æ‚¨ä¹Ÿå¯ä»¥ä¸Šä¼ åŒ…å«å®Œæ•´URLå’Œæ ‡é¢˜çš„æ–‡æœ¬</li>
            </ul>
            <p>ä¸Šä¼ æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥åœ¨é¡µé¢ä¸Šæ·»åŠ æ–°ä¹¦ç­¾ã€åˆ é™¤ä¸éœ€è¦çš„ä¹¦ç­¾ã€‚<strong>æ·»åŠ ä¹¦ç­¾åä¼šè‡ªåŠ¨ä¸‹è½½æ›´æ–°åçš„TXTæ–‡ä»¶</strong>ã€‚</p>
        </div>
        
        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section">
            <label class="upload-label">ğŸ“‚ ä¸Šä¼ TXTä¹¦ç­¾æ–‡ä»¶</label>
            <input type="file" id="txtFileInput" class="upload-input" accept=".txt">
            <button id="uploadBtn" class="upload-btn">
                <span>ğŸ“¤</span> é€‰æ‹©æ–‡ä»¶å¹¶ä¸Šä¼ 
            </button>
            <div id="fileInfo" class="file-info">å°šæœªé€‰æ‹©æ–‡ä»¶</div>
            <div id="uploadError" class="error-message" style="display: none;"></div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel" id="controlPanel" style="display: none;">
            <h3>æˆ‘çš„ä¹¦ç­¾åˆ—è¡¨ (<span id="bookmarkCount">0</span>ä¸ª)</h3>
            <div class="control-buttons">
                <button id="addBookmarkBtn" class="btn">
                    <span>+</span> æ·»åŠ ä¹¦ç­¾
                </button>
                <button id="exportTxtBtn" class="btn btn-export-txt">
                    <span>ğŸ“¥</span> ä¸‹è½½TXTæ–‡ä»¶
                </button>
                <button id="downloadBookmarksBtn" class="btn btn-download">
                    <span>ğŸ“¥</span> ä¸‹è½½HTMLæ–‡ä»¶
                </button>
            </div>
        </div>
        
        <!-- è‡ªåŠ¨ä¸‹è½½è®¾ç½® -->
        <div class="auto-download-toggle" id="autoDownloadToggle" style="display: none;">
            <label>æ·»åŠ ä¹¦ç­¾åè‡ªåŠ¨ä¸‹è½½TXTæ–‡ä»¶ï¼š</label>
            <label class="toggle-switch">
                <input type="checkbox" id="autoDownloadCheckbox" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <!-- æˆåŠŸæ¶ˆæ¯ -->
        <div id="successMessage" class="success-message">
            æ“ä½œæˆåŠŸï¼
        </div>
        
        <!-- ä¹¦ç­¾åˆ—è¡¨ -->
        <div id="bookmarkList">
            <div class="empty-state">è¯·å…ˆä¸Šä¼ TXTæ–‡ä»¶æ¥å¯¼å…¥ä¹¦ç­¾</div>
        </div>
    </div>

    <!-- æ·»åŠ ä¹¦ç­¾æ¨¡æ€æ¡† -->
    <div id="addBookmarkModal" class="modal-overlay">
        <div class="modal">
            <h2>æ·»åŠ æ–°ä¹¦ç­¾</h2>
            <form id="addBookmarkForm">
                <div class="form-group">
                    <label for="bookmarkTitle">ä¹¦ç­¾æ ‡é¢˜</label>
                    <input type="text" id="bookmarkTitle" class="form-control" placeholder="ä¾‹å¦‚ï¼šäº¬ä¸œå•†åŸ" required>
                </div>
                <div class="form-group">
                    <label for="bookmarkUrl">ä¹¦ç­¾URL</label>
                    <input type="url" id="bookmarkUrl" class="form-control" placeholder="https://www.jd.com" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" id="cancelAddBookmark" class="btn btn-cancel">å–æ¶ˆ</button>
                    <button type="submit" class="btn">æ·»åŠ ä¹¦ç­¾</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ä¹¦ç­¾æ•°æ® - åˆå§‹ä¸ºç©º
        let bookmarks = [];
        let autoDownloadEnabled = true;
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const uploadBtn = document.getElementById('uploadBtn');
            const txtFileInput = document.getElementById('txtFileInput');
            const fileInfo = document.getElementById('fileInfo');
            const uploadError = document.getElementById('uploadError');
            const controlPanel = document.getElementById('controlPanel');
            const bookmarkList = document.getElementById('bookmarkList');
            const bookmarkCount = document.getElementById('bookmarkCount');
            const successMessage = document.getElementById('successMessage');
            const autoDownloadToggle = document.getElementById('autoDownloadToggle');
            const autoDownloadCheckbox = document.getElementById('autoDownloadCheckbox');
            
            const addBookmarkBtn = document.getElementById('addBookmarkBtn');
            const exportTxtBtn = document.getElementById('exportTxtBtn');
            const downloadBookmarksBtn = document.getElementById('downloadBookmarksBtn');
            const addBookmarkModal = document.getElementById('addBookmarkModal');
            const cancelAddBookmark = document.getElementById('cancelAddBookmark');
            const addBookmarkForm = document.getElementById('addBookmarkForm');
            const bookmarkTitleInput = document.getElementById('bookmarkTitle');
            const bookmarkUrlInput = document.getElementById('bookmarkUrl');
            
            // è‡ªåŠ¨ä¸‹è½½å¼€å…³
            autoDownloadCheckbox.addEventListener('change', function() {
                autoDownloadEnabled = this.checked;
                showSuccess(`è‡ªåŠ¨ä¸‹è½½å·²${autoDownloadEnabled ? 'å¼€å¯' : 'å…³é—­'}`);
            });
            
            // ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadBtn.addEventListener('click', function() {
                txtFileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©å˜åŒ–æ—¶è§¦å‘
            txtFileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    fileInfo.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                    
                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (!file.name.toLowerCase().endsWith('.txt')) {
                        showError('è¯·é€‰æ‹©TXTæ–‡ä»¶');
                        return;
                    }
                    
                    // è¯»å–æ–‡ä»¶å†…å®¹
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const content = e.target.result;
                        processTxtContent(content);
                    };
                    reader.onerror = function() {
                        showError('è¯»å–æ–‡ä»¶æ—¶å‡ºé”™');
                    };
                    reader.readAsText(file);
                } else {
                    fileInfo.textContent = 'å°šæœªé€‰æ‹©æ–‡ä»¶';
                }
            });
            
            // å¤„ç†TXTæ–‡ä»¶å†…å®¹
            function processTxtContent(content) {
                // æ¸…ç©ºä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
                hideError();
                
                // æ¸…ç©ºä¹‹å‰çš„ä¹¦ç­¾æ•°æ®
                bookmarks = [];
                
                // æŒ‰è¡Œåˆ†å‰²å†…å®¹
                const lines = content.split('\n');
                let parsedCount = 0;
                
                // è§£ææ¯ä¸€è¡Œ
                lines.forEach((line, index) => {
                    line = line.trim();
                    
                    // è·³è¿‡ç©ºè¡Œ
                    if (line.length === 0) return;
                    
                    // å°è¯•è§£æä¹¦ç­¾
                    const bookmark = parseBookmarkLine(line, index + 1);
                    if (bookmark) {
                        bookmarks.push(bookmark);
                        parsedCount++;
                    }
                });
                
                // æ˜¾ç¤ºç»“æœ
                if (parsedCount > 0) {
                    // æ˜¾ç¤ºæ§åˆ¶é¢æ¿
                    controlPanel.style.display = 'flex';
                    
                    // æ˜¾ç¤ºè‡ªåŠ¨ä¸‹è½½è®¾ç½®
                    autoDownloadToggle.style.display = 'flex';
                    
                    // æ›´æ–°ä¹¦ç­¾æ•°é‡
                    updateBookmarkCount();
                    
                    // åŠ è½½ä¹¦ç­¾åˆ—è¡¨
                    loadBookmarks();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showSuccess(`æˆåŠŸå¯¼å…¥ ${parsedCount} ä¸ªä¹¦ç­¾`);
                    
                    // åˆå§‹åŒ–åŠŸèƒ½æŒ‰é’®
                    initBookmarkFunctions();
                } else {
                    showError('æœªèƒ½ä»æ–‡ä»¶ä¸­è§£æå‡ºä»»ä½•ä¹¦ç­¾ã€‚è¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€‚');
                }
            }
            
            // è§£æä¹¦ç­¾è¡Œ
            function parseBookmarkLine(line, lineNumber) {
                // å°è¯•ç”¨é€—å·åˆ†å‰²
                const commaIndex = line.indexOf(',');
                
                if (commaIndex !== -1) {
                    // æ ¼å¼ï¼šæ ‡é¢˜,URL
                    const title = line.substring(0, commaIndex).trim();
                    const url = line.substring(commaIndex + 1).trim();
                    
                    if (title && url) {
                        // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
                        let fullUrl = url;
                        if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {
                            fullUrl = 'https://' + fullUrl;
                        }
                        
                        return {
                            title: title,
                            url: fullUrl
                        };
                    }
                }
                
                // å°è¯•ç”¨ç©ºæ ¼åˆ†å‰²
                const spaceIndex = line.indexOf(' ');
                if (spaceIndex !== -1) {
                    const title = line.substring(0, spaceIndex).trim();
                    const url = line.substring(spaceIndex + 1).trim();
                    
                    if (title && url) {
                        // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
                        let fullUrl = url;
                        if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {
                            fullUrl = 'https://' + fullUrl;
                        }
                        
                        return {
                            title: title,
                            url: fullUrl
                        };
                    }
                }
                
                // å¦‚æœæ•´è¡Œçœ‹èµ·æ¥åƒURLï¼Œåˆ™ä½¿ç”¨URLä½œä¸ºæ ‡é¢˜
                if (line.includes('http://') || line.includes('https://') || line.includes('www.')) {
                    // æå–åŸŸåä½œä¸ºæ ‡é¢˜
                    let title = extractDomainFromUrl(line);
                    let url = line;
                    
                    // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        url = 'https://' + url;
                    }
                    
                    return {
                        title: title,
                        url: url
                    };
                }
                
                // æ— æ³•è§£æçš„è¡Œ
                console.warn(`ç¬¬ ${lineNumber} è¡Œæ— æ³•è§£æ: ${line}`);
                return null;
            }
            
            // ä»URLæå–åŸŸå
            function extractDomainFromUrl(url) {
                try {
                    // å¦‚æœURLæ²¡æœ‰åè®®ï¼Œå…ˆæ·»åŠ ä¸€ä¸ª
                    let fullUrl = url;
                    if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {
                        fullUrl = 'https://' + fullUrl;
                    }
                    
                    const urlObj = new URL(fullUrl);
                    return urlObj.hostname;
                } catch (e) {
                    // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›åŸå§‹URL
                    return url;
                }
            }
            
            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            function showError(message) {
                uploadError.textContent = message;
                uploadError.style.display = 'block';
            }
            
            // éšè—é”™è¯¯æ¶ˆæ¯
            function hideError() {
                uploadError.style.display = 'none';
            }
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 3000);
            }
            
            // æ›´æ–°ä¹¦ç­¾æ•°é‡æ˜¾ç¤º
            function updateBookmarkCount() {
                bookmarkCount.textContent = bookmarks.length;
            }
            
            // åŠ è½½å¹¶æ˜¾ç¤ºä¹¦ç­¾åˆ—è¡¨
            function loadBookmarks() {
                bookmarkList.innerHTML = '';
                
                if (bookmarks.length === 0) {
                    bookmarkList.innerHTML = '<div class="empty-state">æš‚æ— ä¹¦ç­¾ï¼Œç‚¹å‡»"æ·»åŠ ä¹¦ç­¾"æŒ‰é’®å¼€å§‹æ·»åŠ </div>';
                    return;
                }
                
                bookmarks.forEach((bookmark, index) => {
                    const bookmarkItem = document.createElement('div');
                    bookmarkItem.className = 'bookmark-item';
                    bookmarkItem.innerHTML = `
                        <a href="${bookmark.url}" class="bookmark-link" target="_blank">
                            ${bookmark.title}
                        </a>
                        <div class="bookmark-actions">
                            <button class="bookmark-btn delete-btn" data-index="${index}">åˆ é™¤</button>
                        </div>
                    `;
                    bookmarkList.appendChild(bookmarkItem);
                });
                
                // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        if (confirm(`ç¡®å®šè¦åˆ é™¤ä¹¦ç­¾"${bookmarks[index].title}"å—ï¼Ÿ`)) {
                            bookmarks.splice(index, 1);
                            updateBookmarkCount();
                            loadBookmarks();
                            showSuccess('ä¹¦ç­¾å·²åˆ é™¤');
                        }
                    });
                });
            }
            
            // åˆå§‹åŒ–ä¹¦ç­¾åŠŸèƒ½
            function initBookmarkFunctions() {
                // æ·»åŠ ä¹¦ç­¾åŠŸèƒ½
                addBookmarkBtn.addEventListener('click', function() {
                    addBookmarkModal.style.display = 'flex';
                    bookmarkTitleInput.focus();
                });
                
                cancelAddBookmark.addEventListener('click', function() {
                    addBookmarkModal.style.display = 'none';
                    addBookmarkForm.reset();
                });
                
                addBookmarkForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const title = bookmarkTitleInput.value.trim();
                    const url = bookmarkUrlInput.value.trim();
                    
                    if (!title) {
                        alert('è¯·è¾“å…¥ä¹¦ç­¾æ ‡é¢˜');
                        return;
                    }
                    
                    if (!url) {
                        alert('è¯·è¾“å…¥ä¹¦ç­¾URL');
                        return;
                    }
                    
                    // ç¡®ä¿URLæœ‰åè®®å‰ç¼€
                    let fullUrl = url;
                    if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) {
                        fullUrl = 'https://' + fullUrl;
                    }
                    
                    // æ·»åŠ æ–°ä¹¦ç­¾
                    bookmarks.push({
                        title: title,
                        url: fullUrl
                    });
                    
                    // æ›´æ–°ä¹¦ç­¾æ•°é‡
                    updateBookmarkCount();
                    
                    // é‡æ–°åŠ è½½ä¹¦ç­¾åˆ—è¡¨
                    loadBookmarks();
                    
                    // å…³é—­æ¨¡æ€æ¡†å¹¶é‡ç½®è¡¨å•
                    addBookmarkModal.style.display = 'none';
                    addBookmarkForm.reset();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    const successMsg = `ä¹¦ç­¾"${title}"å·²æˆåŠŸæ·»åŠ ï¼`;
                    showSuccess(successMsg);
                    
                    // å¦‚æœè‡ªåŠ¨ä¸‹è½½å¼€å¯ï¼Œåˆ™ä¸‹è½½æ›´æ–°åçš„TXTæ–‡ä»¶
                    if (autoDownloadEnabled) {
                        // å»¶è¿Ÿä¸€ä¸‹ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
                        setTimeout(() => {
                            downloadTxtFile('æ·»åŠ ä¹¦ç­¾åè‡ªåŠ¨ä¸‹è½½');
                        }, 500);
                    }
                });
                
                // ä¸‹è½½TXTæ–‡ä»¶åŠŸèƒ½
                exportTxtBtn.addEventListener('click', function() {
                    if (bookmarks.length === 0) {
                        alert('å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„ä¹¦ç­¾');
                        return;
                    }
                    
                    downloadTxtFile('æ‰‹åŠ¨ä¸‹è½½');
                });
                
                // ä¸‹è½½HTMLæ–‡ä»¶åŠŸèƒ½
                downloadBookmarksBtn.addEventListener('click', function() {
                    if (bookmarks.length === 0) {
                        alert('å½“å‰æ²¡æœ‰å¯ä¸‹è½½çš„ä¹¦ç­¾');
                        return;
                    }
                    
                    // ç”Ÿæˆå®Œæ•´çš„HTMLæ–‡ä»¶å†…å®¹
                    const htmlContent = generateHtmlFile();
                    
                    // åˆ›å»ºBlobå¯¹è±¡
                    const blob = new Blob([htmlContent], {type: 'text/html;charset=utf-8'});
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const downloadLink = document.createElement('a');
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.download = `ä¹¦ç­¾æ”¶è—_${new Date().toISOString().split('T')[0]}.html`;
                    
                    // è§¦å‘ä¸‹è½½
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showSuccess(`HTMLæ–‡ä»¶å·²ä¸‹è½½ï¼ŒåŒ…å« ${bookmarks.length} ä¸ªä¹¦ç­¾`);
                });
                
                // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
                addBookmarkModal.addEventListener('click', function(e) {
                    if (e.target === addBookmarkModal) {
                        addBookmarkModal.style.display = 'none';
                        addBookmarkForm.reset();
                    }
                });
            }
            
            // ä¸‹è½½TXTæ–‡ä»¶å‡½æ•°
            function downloadTxtFile(source) {
                if (bookmarks.length === 0) {
                    alert('å½“å‰æ²¡æœ‰å¯å¯¼å‡ºçš„ä¹¦ç­¾');
                    return;
                }
                
                // ç”ŸæˆTXTæ–‡ä»¶å†…å®¹
                let txtContent = '';
                bookmarks.forEach(bookmark => {
                    txtContent += `${bookmark.title},${bookmark.url}\n`;
                });
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([txtContent], {type: 'text/plain;charset=utf-8'});
                
                // ç”Ÿæˆæ–‡ä»¶å
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                
                let filename = `ä¹¦ç­¾åˆ—è¡¨_${dateStr}_${timeStr}.txt`;
                if (source === 'æ·»åŠ ä¹¦ç­¾åè‡ªåŠ¨ä¸‹è½½') {
                    filename = `ä¹¦ç­¾åˆ—è¡¨_è‡ªåŠ¨æ›´æ–°_${dateStr}_${timeStr}.txt`;
                }
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(blob);
                downloadLink.download = filename;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                if (source === 'æ·»åŠ ä¹¦ç­¾åè‡ªåŠ¨ä¸‹è½½') {
                    showSuccess(`å·²è‡ªåŠ¨ä¸‹è½½æ›´æ–°åçš„TXTæ–‡ä»¶ï¼ŒåŒ…å« ${bookmarks.length} ä¸ªä¹¦ç­¾`);
                } else {
                    showSuccess(`TXTæ–‡ä»¶å·²ä¸‹è½½ï¼ŒåŒ…å« ${bookmarks.length} ä¸ªä¹¦ç­¾`);
                }
            }
        });
        
        // ç”Ÿæˆå®Œæ•´çš„HTMLæ–‡ä»¶å†…å®¹
        function generateHtmlFile() {
            // ç”Ÿæˆä¹¦ç­¾åˆ—è¡¨çš„HTML
            let bookmarksHtml = '';
            bookmarks.forEach(bookmark => {
                bookmarksHtml += `
                    <div class="bookmark-item">
                        <a href="${bookmark.url}" class="bookmark-link" target="_blank">
                            ${bookmark.title}
                        </a>
                    </div>`;
            });
            
            // å®Œæ•´çš„HTMLæ–‡ä»¶
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ä¹¦ç­¾æ”¶è—</title>
    <style>
        body {
            background-color: #f0f8ff;
            color: #333;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
        }
        
        #bookmarkList {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .bookmark-item {
            padding: 12px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .bookmark-link {
            color: #2980b9;
            text-decoration: none;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .bookmark-link:hover {
            background-color: #e8f4fc;
            text-decoration: underline;
        }
        
        .empty-state {
            text-align: center;
            color: #95a5a6;
            padding: 40px 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š æˆ‘çš„ä¹¦ç­¾æ”¶è—</h1>
        
        <div id="bookmarkList">
            ${bookmarksHtml}
        </div>
        
        <div style="text-align: center; margin-top: 30px; color: #7f8c8d; font-size: 14px;">
            å…± ${bookmarks.length} ä¸ªä¹¦ç­¾ | ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}
        </div>
    </div>
</body>
</html>`;
        }
    </script>
</body>
</html>
